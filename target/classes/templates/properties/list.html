<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8"/>
  <title>RealNest - Listings</title>
  <link th:href="@{/css/base.css}" rel="stylesheet"/>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<div class="container">
  <section class="featured-showcase">
    <div class="showcase-text">
      <p class="eyebrow">Handpicked luxury</p>
      <h1>Explore architectural masterpieces</h1>
      <p class="subtext">
        These five newly uploaded residences highlight the craftsmanship and ambience buyers expect
        from RealNest's premier listings.
      </p>
    </div>
    <div class="showcase-grid">
      <img th:src="@{/img/featured-1.jpg}" alt="Modern villa exterior"/>
      <img th:src="@{/img/featured-2.jpg}" alt="Layered luxury residence"/>
      <img th:src="@{/img/featured-3.jpg}" alt="Glass villa with infinity pool"/>
      <img th:src="@{/img/featured-4.jpg}" alt="Terraced hillside property"/>
      <img th:src="@{/img/featured-5.jpg}" alt="Contemporary estate with garden"/>
    </div>
  </section>
  <section class="filters">
    <form method="get" th:action="@{/properties}" class="form-inline">
      <input type="text"
             name="location"
             placeholder="City or neighborhood"
             th:value="${location}"/>
      <select name="type">
        <option value="">Any type</option>
        <option th:each="t : ${types}"
                th:value="${t}"
                th:selected="${t == type}"
                th:text="${t}">SALE</option>
      </select>
      <input type="number" name="min" placeholder="Min price" th:value="${min}"/>
      <input type="number" name="max" placeholder="Max price" th:value="${max}"/>
      <button type="submit" class="link-button medium">Filter</button>
      <a class="link-button secondary" th:href="@{/properties}">Reset</a>
    </form>
  </section>
  <h2>Browse Properties</h2>
  <p th:text="${resultCount} + ' results found'">0 results found</p>
  <div class="property-grid" th:if="${page != null and !page.empty}">
    <article class="property-card" th:each="p : ${page.content}">
      <img th:if="${p.imageUrl != null and !#strings.isEmpty(p.imageUrl)}"
           th:src="@{${p.imageUrl}}"
           th:alt="${p.title}"
           class="property-img"/>
      <img th:if="${p.imageUrl == null or #strings.isEmpty(p.imageUrl)}"
           th:src="@{/img/default-property.svg}"
           th:alt="'Placeholder image for ' + ${p.title}"
           class="property-img"/>
      <div class="property-card__body">
        <strong class="property-card__title" th:text="${p.title}">Title</strong>
        <p class="property-card__location" th:text="${p.location}">Location</p>
        <p class="property-card__type" th:text="${p.type}">Type</p>
        <p class="property-card__price" th:text="${#numbers.formatCurrency(p.price)}">$0</p>
        <div class="property-card__actions">
          <a class="link-button medium" th:href="@{'/properties/' + ${p.id}}">View details</a>
          <div class="card-actions"
               th:if="${currentUserEmail != null and p.owner != null and p.owner.email == currentUserEmail}">
            <a class="link-button secondary" th:href="@{'/properties/' + ${p.id} + '/edit'}">Edit</a>
            <form th:action="@{'/properties/' + ${p.id} + '/delete'}"
                  method="post"
                  onsubmit="return confirm('Delete this listing?');">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
              <button class="link-button danger" type="submit">Delete</button>
            </form>
          </div>
        </div>
      </div>
    </article>
  </div>
  <p th:if="${page == null or page.empty}">No listings match your filters.</p>
  <div th:replace="~{fragments/pagination :: pager(${page}, '/properties', ${searchParams})}"></div>
</div>
</body>
</html>
